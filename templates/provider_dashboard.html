<!DOCTYPE html>
<html>
<head>
    <title>Provider Dashboard</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/provider_dashboard.css') }}">
</head>
<body>
    <div class="container">
        <div class="header">
            <div>
                <h1>Provider Dashboard</h1>
                <p class="welcome-text">Welcome back, {{ provider.username }}!</p>
            </div>
            <div>
                <a href="{{ url_for('provider_profile') }}" class="btn">Edit Profile</a>
                <a href="{{ url_for('logout') }}" class="btn" style="background-color: #e74c3c;">Logout</a>
            </div>
        </div>

        <div class="stats">
            <div class="stat-item">
                <div class="stat-value">{{ stats.total_bookings }}</div>
                <div class="stat-label">Total Bookings</div>
            </div>
            <div class="stat-item">
                <div class="stat-value">{{ stats.upcoming_bookings }}</div>
                <div class="stat-label">Upcoming Bookings</div>
            </div>
            <div class="stat-item">
                <div class="stat-value">{{ stats.completed_bookings }}</div>
                <div class="stat-label">Completed Bookings</div>
            </div>
        </div>

        <div class="dashboard-grid">
            <div class="dashboard-card">
                <div class="card-header">
                    <h2 class="card-title">Upcoming Bookings</h2>
                </div>
                {% if upcoming_bookings %}
                <ul class="booking-list">
                    {% for booking in upcoming_bookings %}
                    <li class="booking-item">
                        <div class="booking-date">{{ booking.booking_date.strftime('%B %d, %Y') }}</div>
                        <div class="booking-customer">
                            Customer: {{ booking.customer.username }}<br>
                            Contact: {{ booking.customer.email }}
                        </div>
                        {% if booking.status == 'pending' %}
                        <div class="booking-actions">
                            <button class="btn btn-approve" onclick="updateBookingStatus({{ booking.id }}, 'approve')">
                                Approve
                            </button>
                            <button class="btn btn-decline" onclick="updateBookingStatus({{ booking.id }}, 'decline')">
                                Decline
                            </button>
                        </div>
                        {% endif %}
                    </li>
                    {% endfor %}
                </ul>
                {% else %}
                <p>No upcoming bookings</p>
                {% endif %}
            </div>

            <div class="dashboard-card">
                <div class="card-header">
                    <h2 class="card-title">Recent Activity</h2>
                </div>
                {% if recent_bookings %}
                <ul class="booking-list">
                    {% for booking in recent_bookings %}
                    <li class="booking-item">
                        <div class="booking-date">{{ booking.booking_date.strftime('%B %d, %Y') }}</div>
                        <div class="booking-customer">
                            Status: 
                            <span class="status-{{ booking.status }}">
                                {{ booking.status|title }}
                            </span>
                        </div>
                        {% if booking.status == 'pending' %}
                        <div class="booking-actions">
                            <button class="btn btn-approve" onclick="updateBookingStatus({{ booking.id }}, 'approve')">
                                Approve
                            </button>
                            <button class="btn btn-decline" onclick="updateBookingStatus({{ booking.id }}, 'decline')">
                                Decline
                            </button>
                        </div>
                        {% endif %}
                    </li>
                    {% endfor %}
                </ul>
                {% else %}
                <p>No recent activity</p>
                {% endif %}
            </div>
        </div>

        {% if pending_update %}
        <div class="dashboard-card">
            <div class="card-header">
                <h2 class="card-title">Profile Update Status</h2>
            </div>
            <p class="status-pending">You have pending changes awaiting admin approval</p>
            <p>Submitted on: {{ pending_update.submitted_at.strftime('%B %d, %Y at %H:%M') }}</p>
        </div>
        {% endif %}

        <div class="dashboard-card">
            <div class="card-header">
                <h2 class="card-title">Manage Service Images</h2>
            </div>
            <div id="provider-images-section">
                <form id="uploadImagesForm" enctype="multipart/form-data">
                    <label for="images">Add Images:</label>
                    <input type="file" id="images" name="images" accept="image/*" multiple>
                    <button type="submit" class="btn">Upload</button>
                </form>
                <div id="images-list" style="margin-top: 20px;"></div>
            </div>
        </div>
    </div>

    <script src="{{ url_for('static', filename='js/provider_dashboard.js') }}"></script>
    <script>
    function fetchProviderImages() {
        fetch('/provider/images')
            .then(res => res.json())
            .then(data => {
                const list = document.getElementById('images-list');
                list.innerHTML = '';
                if (data.images && data.images.length > 0) {
                    data.images.forEach(filename => {
                        const div = document.createElement('div');
                        div.style.display = 'flex';
                        div.style.alignItems = 'center';
                        div.style.marginBottom = '10px';
                        div.innerHTML = `<img src="/static/images/edit images/${filename}" style="max-width: 120px; max-height: 80px; border-radius: 8px; margin-right: 10px;">` +
                            `<button class='btn btn-danger btn-sm' onclick='deleteProviderImage("${filename}")'>Delete</button>`;
                        list.appendChild(div);
                    });
                } else {
                    list.innerHTML = '<span class="text-muted">No images uploaded yet.</span>';
                }
            });
    }
    function deleteProviderImage(filename) {
        if (!confirm('Delete this image?')) return;
        fetch('/provider/images', {
            method: 'DELETE',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ filename })
        })
        .then(res => res.json())
        .then(data => {
            if (data.success) fetchProviderImages();
            else alert(data.message || 'Error deleting image');
        });
    }
    document.getElementById('uploadImagesForm').addEventListener('submit', function(e) {
        e.preventDefault();
        const formData = new FormData(this);
        fetch('/provider/images', {
            method: 'POST',
            body: formData
        })
        .then(res => res.json())
        .then(data => {
            if (data.success) {
                fetchProviderImages();
                this.reset();
            } else {
                alert(data.message || 'Error uploading images');
            }
        });
    });
    fetchProviderImages();
    </script>
</body>
</html> 